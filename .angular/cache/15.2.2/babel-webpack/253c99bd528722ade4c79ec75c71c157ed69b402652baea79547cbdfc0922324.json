{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { Storage } from '@ionic/storage';\nimport { ModalController, AlertController } from '@ionic/angular';\nimport { AddRoomPage } from '../add-room/add-room.page';\nimport { RoomPage } from '../room/room.page';\nimport { ControllerService } from '../services/controller.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/storage\";\nimport * as i2 from \"@ionic/angular\";\nimport * as i3 from \"../services/controller.service\";\nimport * as i4 from \"@angular/common\";\nfunction HomePage_ion_row_11_ion_col_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-col\", 19)(1, \"ion-item\", 20);\n    i0.ɵɵlistener(\"click\", function HomePage_ion_row_11_ion_col_1_Template_ion_item_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const widget_r6 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r7.presentAlertConfirm(widget_r6));\n    });\n    i0.ɵɵelementStart(2, \"ion-label\")(3, \"span\", 21);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(7, \"ion-ripple-effect\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const widget_r6 = ctx.$implicit;\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate(\"id\", widget_r6.value);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r5.widgetValue);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(widget_r6.name);\n  }\n}\nfunction HomePage_ion_row_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-row\");\n    i0.ɵɵtemplate(1, HomePage_ion_row_11_ion_col_1_Template, 8, 3, \"ion-col\", 18);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.widgets);\n  }\n}\nfunction HomePage_ion_row_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-row\")(1, \"ion-col\", 22)(2, \"p\");\n    i0.ɵɵtext(3, \"No widgets added yet\");\n    i0.ɵɵelementEnd()()();\n  }\n}\nfunction HomePage_ion_slide_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-slide\")(1, \"ion-card\", 23)(2, \"ion-card-content\");\n    i0.ɵɵelement(3, \"ion-icon\", 24);\n    i0.ɵɵelementStart(4, \"ion-card-header\", 25)(5, \"ion-card-subtitle\", 11);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(7, \"ion-ripple-effect\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const scene_r9 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate(\"name\", scene_r9.icon);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(scene_r9.title);\n  }\n}\nfunction HomePage_ion_slides_28_ion_slide_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-slide\")(1, \"ion-card\", 26)(2, \"ion-card-content\", 27);\n    i0.ɵɵlistener(\"click\", function HomePage_ion_slides_28_ion_slide_1_Template_ion_card_content_click_2_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const room_r11 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r12.openRoom(room_r11.id, $event));\n    });\n    i0.ɵɵelement(3, \"img\", 28);\n    i0.ɵɵelementStart(4, \"ion-card-header\", 11)(5, \"ion-card-title\", 11);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"ion-card-subtitle\", 11);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelement(9, \"ion-ripple-effect\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const room_r11 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate(\"src\", room_r11.image, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(room_r11.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", room_r11.devices.length, \" Devices\");\n  }\n}\nfunction HomePage_ion_slides_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-slides\", 12);\n    i0.ɵɵtemplate(1, HomePage_ion_slides_28_ion_slide_1_Template, 10, 3, \"ion-slide\", 13);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"options\", ctx_r3.roomsSlideOpts);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.rooms);\n  }\n}\nfunction HomePage_ion_card_content_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card-content\")(1, \"p\", 29);\n    i0.ɵɵtext(2, \"No rooms added yet\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let HomePage = /*#__PURE__*/(() => {\n  class HomePage {\n    constructor(storage, modalCtrl, controller, alertCtrl) {\n      this.storage = storage;\n      this.modalCtrl = modalCtrl;\n      this.controller = controller;\n      this.alertCtrl = alertCtrl;\n      this.widgets = [];\n      this.widgetValue = \"~\";\n      this.rooms = [];\n      this.scenesSlideOpts = {\n        slidesPerView: 2,\n        spaceBetween: 0,\n        speed: 400\n      };\n      this.roomsSlideOpts = {\n        slidesPerView: 2,\n        spaceBetween: 0,\n        speed: 400\n      };\n      this.isWidgetEmpty = true;\n      this.scenes = [{\n        icon: \"home\",\n        title: \"Home\"\n      }, {\n        icon: \"airplane\",\n        title: \"Away\"\n      }, {\n        icon: \"moon\",\n        title: \"Night\"\n      }, {\n        icon: \"alarm\",\n        title: \"Get Up\"\n      }];\n      if (window.screen.width <= 360) {\n        this.roomsSlideOpts = {\n          slidesPerView: 1,\n          spaceBetween: 0,\n          speed: 400\n        };\n      }\n    }\n    ngOnInit() {\n      this.controller.MQTT().connect({\n        onSuccess: this.getWidgets.bind(this),\n        onFailure: this.controller.onFail.bind(this)\n      });\n      this.getRooms();\n    }\n    getWidgets() {\n      this.storage.get(\"widgets\").then(val => {\n        if (val && val.length > 0) {\n          this.isWidgetEmpty = false;\n          this.widgets = val;\n          console.log(this.widgets);\n          this.widgets.forEach(element => {\n            this.controller.client.subscribe(element.value, 0);\n            this.controller.client.onMessageArrived = this.widgetMessageArrived.bind(this);\n          });\n        } else {\n          this.isWidgetEmpty = true;\n        }\n      });\n    }\n    widgetMessageArrived(message) {\n      let element = this.widgets.find(element => element.value === message.destinationName);\n      let prefix = '';\n      let postfix = '';\n      let precision = 2;\n      if (element.prefix) prefix = element.prefix;\n      if (element.postfix) postfix = element.postfix;\n      if (element.precision) precision = element.precision;\n      document.getElementById(message.destinationName).innerHTML = prefix + parseFloat(message.payloadString).toFixed(precision) + postfix;\n    }\n    getRooms() {\n      if (window.screen.width <= 360) {\n        this.roomsSlideOpts = {\n          slidesPerView: 1,\n          spaceBetween: 0,\n          speed: 400\n        };\n      }\n      if (window.screen.width >= 768) {\n        this.scenesSlideOpts = {\n          slidesPerView: 4,\n          spaceBetween: 0,\n          speed: 400\n        };\n      }\n      this.storage.get(\"rooms\").then(res => {\n        if (res.length > 0 && res) {\n          this.isEmpty = true;\n          this.rooms = res;\n          if (this.rooms.length == 1) {\n            this.roomsSlideOpts = {\n              slidesPerView: 1,\n              spaceBetween: 0,\n              speed: 400\n            };\n          }\n        } else {\n          this.isEmpty = false;\n        }\n      });\n    }\n    addRooms() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const modal = yield this.modalCtrl.create({\n          component: AddRoomPage,\n          mode: \"ios\"\n        });\n        modal.onDidDismiss().then(() => {\n          this.getRooms();\n        });\n        return yield modal.present();\n      });\n    }\n    openRoom(id) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const modal = yield this.modalCtrl.create({\n          component: RoomPage,\n          componentProps: {\n            'roomData': this.rooms.find(element => element.id === id)\n          },\n          mode: \"ios\"\n        });\n        modal.onDidDismiss().then(() => {\n          this.getWidgets();\n          this.getRooms();\n        });\n        return yield modal.present();\n      });\n    }\n    presentAlertConfirm(widget) {\n      return __awaiter(this, void 0, void 0, function* () {\n        console.log(widget);\n        const alert = yield this.alertCtrl.create({\n          header: 'Confirm',\n          message: 'Do you want to delete this widget?',\n          mode: \"ios\",\n          buttons: [{\n            text: 'Cancel',\n            role: 'cancel',\n            cssClass: 'secondary',\n            handler: blah => {\n              console.log('Confirm Cancel: blah');\n            }\n          }, {\n            text: 'Okay',\n            handler: () => {\n              this.widgets.forEach((element, i) => {\n                if (element.id == widget.id) {\n                  this.widgets.splice(i, 1);\n                }\n              });\n              console.log(this.widgets);\n              this.storage.set(\"widgets\", this.widgets);\n            }\n          }]\n        });\n        alert.onDidDismiss().then(() => {\n          this.getWidgets();\n        });\n        yield alert.present();\n      });\n    }\n  }\n  HomePage.ɵfac = function HomePage_Factory(t) {\n    return new (t || HomePage)(i0.ɵɵdirectiveInject(i1.Storage), i0.ɵɵdirectiveInject(i2.ModalController), i0.ɵɵdirectiveInject(i3.ControllerService), i0.ɵɵdirectiveInject(i2.AlertController));\n  };\n  HomePage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: HomePage,\n    selectors: [[\"app-home\"]],\n    decls: 30,\n    vars: 6,\n    consts: [[\"color\", \"primary\", \"mode\", \"ios\", 1, \"first-toolbar\"], [\"slot\", \"start\"], [\"slot\", \"end\"], [\"text-medium\", \"\", \"slot\", \"icon-only\", \"name\", \"notifications\"], [\"color\", \"primary\", \"mode\", \"ios\", 1, \"second-toolbar\"], [4, \"ngIf\"], [\"color\", \"light\"], [1, \"grid-content\", \"ion-no-padding\"], [1, \"ion-no-padding\"], [\"color\", \"tint\", \"mode\", \"ios\", 1, \"homeCard\", \"ion-no-margin\"], [\"mode\", \"md\", 1, \"scenesHeader\", \"ion-margin\"], [\"mode\", \"md\"], [3, \"options\"], [4, \"ngFor\", \"ngForOf\"], [1, \"roomsHeader\", \"ion-margin\"], [1, \"ion-activatable\"], [\"name\", \"add\", 1, \"plus\", 3, \"click\"], [3, \"options\", 4, \"ngIf\"], [\"col-6\", \"\", 4, \"ngFor\", \"ngForOf\"], [\"col-6\", \"\"], [\"lines\", \"none\", \"color\", \"shade\", 1, \"ion-text-center\", \"ion-activatable\", \"widget\", 3, \"click\"], [3, \"id\"], [\"col-12\", \"\", 1, \"ion-text-center\"], [\"mode\", \"ios\", 1, \"sceneCard\", \"ion-activatable\", \"ion-text-center\", \"ion-no-margin\"], [\"text-medium\", \"\", 3, \"name\"], [\"mode\", \"md\", 1, \"ion-no-padding\"], [\"mode\", \"ios\", 1, \"roomCard\", \"ion-activatable\", \"ion-text-center\", \"ion-no-margin\"], [3, \"click\"], [\"height\", \"100\", 3, \"src\"], [1, \"ion-text-center\"]],\n    template: function HomePage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\", 0)(2, \"ion-buttons\", 1);\n        i0.ɵɵelement(3, \"ion-menu-button\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-title\");\n        i0.ɵɵtext(5, \" Control Panel \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"ion-buttons\", 2)(7, \"ion-button\");\n        i0.ɵɵelement(8, \"ion-icon\", 3);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(9, \"ion-toolbar\", 4)(10, \"ion-grid\");\n        i0.ɵɵtemplate(11, HomePage_ion_row_11_Template, 2, 1, \"ion-row\", 5);\n        i0.ɵɵtemplate(12, HomePage_ion_row_12_Template, 4, 0, \"ion-row\", 5);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(13, \"ion-content\", 6)(14, \"ion-list\", 7)(15, \"ion-grid\", 8)(16, \"ion-card\", 9)(17, \"ion-card-header\", 10)(18, \"ion-card-title\", 11);\n        i0.ɵɵtext(19, \"Scenes\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(20, \"ion-slides\", 12);\n        i0.ɵɵtemplate(21, HomePage_ion_slide_21_Template, 8, 2, \"ion-slide\", 13);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"ion-card-header\", 14)(23, \"ion-card-title\", 11);\n        i0.ɵɵtext(24, \"Rooms \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"div\", 15)(26, \"ion-icon\", 16);\n        i0.ɵɵlistener(\"click\", function HomePage_Template_ion_icon_click_26_listener() {\n          return ctx.addRooms();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(27, \"ion-ripple-effect\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(28, HomePage_ion_slides_28_Template, 2, 2, \"ion-slides\", 17);\n        i0.ɵɵtemplate(29, HomePage_ion_card_content_29_Template, 3, 0, \"ion-card-content\", 5);\n        i0.ɵɵelementEnd()()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"ngIf\", !ctx.isWidgetEmpty);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isWidgetEmpty);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"options\", ctx.scenesSlideOpts);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.scenes);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngIf\", ctx.isEmpty);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.isEmpty);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i2.IonButton, i2.IonButtons, i2.IonCard, i2.IonCardContent, i2.IonCardHeader, i2.IonCardSubtitle, i2.IonCardTitle, i2.IonCol, i2.IonContent, i2.IonGrid, i2.IonHeader, i2.IonIcon, i2.IonItem, i2.IonLabel, i2.IonList, i2.IonMenuButton, i2.IonRippleEffect, i2.IonRow, i2.IonSlide, i2.IonSlides, i2.IonTitle, i2.IonToolbar],\n    styles: [\".header-md[_ngcontent-%COMP%]:after{background-image:none!important}ion-header[_ngcontent-%COMP%]   .first-toolbar[_ngcontent-%COMP%]{padding-top:36px}ion-header[_ngcontent-%COMP%]   .second-toolbar[_ngcontent-%COMP%]{padding-bottom:70px}.negative-margin[_ngcontent-%COMP%]{margin-top:-20px}[text-medium][_ngcontent-%COMP%]{font-size:1.6rem}[text-small][_ngcontent-%COMP%]{font-size:.8rem}.plus[_ngcontent-%COMP%]{position:absolute;right:0;top:1rem;font-size:20px}ion-header[_ngcontent-%COMP%]{position:absolute;z-index:1}.grid-content[_ngcontent-%COMP%]{z-index:999;display:block;position:relative;transform:translateY(182px);background:#fff;border-top-left-radius:50px;border-top-right-radius:50px}.inner-scroll[_ngcontent-%COMP%]   scroll-y[_ngcontent-%COMP%]{border-top-left-radius:50px;border-top-right-radius:50px}.usageCard[_ngcontent-%COMP%]{margin-bottom:30px;box-shadow:none;border-radius:16px}.homeCard[_ngcontent-%COMP%]{box-shadow:none;border-top-left-radius:46px;border-top-right-radius:46px}.scenesHeader[_ngcontent-%COMP%]{margin-bottom:0;margin-left:0}.widget[_ngcontent-%COMP%]{border-radius:20px!important}.sceneCard[_ngcontent-%COMP%]{width:100%;background:#fff;border-radius:20px;margin-left:.4rem;margin-right:.4rem;margin-bottom:.8rem}.sceneCard[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{font-size:.8rem}.sceneCard[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:2rem}.roomsHeader[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0;margin-left:0}.roomCard[_ngcontent-%COMP%]{width:100%;height:max-content;background:#fff;border-radius:20px;margin-left:.4rem;margin-right:.4rem;margin-bottom:.8rem}.roomCard[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{font-size:.8rem}.swiper-slide[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:120px}\"]\n  });\n  HomePage.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: HomePage,\n    factory: HomePage.ɵfac\n  });\n  return HomePage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}